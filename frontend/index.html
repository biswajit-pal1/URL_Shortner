<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>URL Shortener</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”— URL Shortener</h1>
      <form id="url-form">
        <input type="url" id="full-url" placeholder="Enter full URL" required />
        <button type="submit">Shorten</button>
      </form>

      <div id="result" class="hidden">
        <p>
          Short URL:
          <a id="short-url" href="#" target="_blank"></a>
        </p>
        <button id="copy-btn">ğŸ“‹ Copy</button>
        <span id="copy-msg" class="copy-msg"></span>

        <h3>ğŸ“± Or, scan the QR Code:</h3>
        <div id="outterQr">
          <div id="qrcode"></div>
        </div>
      </div>
    </div>

    <!-- QRCode.js library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <script>
      const serverUrl = "http://localhost:3000";
      const form = document.getElementById("url-form");
      const resultDiv = document.getElementById("result");
      const shortUrlLink = document.getElementById("short-url");
      const copyBtn = document.getElementById("copy-btn");
      const copyMsg = document.getElementById("copy-msg");
      const qrContainer = document.getElementById("qrcode");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const fullUrl = document.getElementById("full-url").value;

        try {
          const res = await fetch(`/shorten`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ full: fullUrl }),
          });

          const data = await res.json();
          const shortUrl = `${window.location.origin}/${data.short}`;

          shortUrlLink.href = shortUrl;
          shortUrlLink.textContent = shortUrl;
          resultDiv.classList.remove("hidden");
          copyMsg.textContent = "";

          qrContainer.innerHTML = ""; // clear old QR
          new QRCode(qrContainer, {
            text: shortUrl,
            width: 150,
            height: 150,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H,
          });
        } catch (err) {
          alert("Something went wrong. Check console for details.");
          console.error(err);
        }
      });

      copyBtn.addEventListener("click", () => {
        const url = shortUrlLink.href;
        navigator.clipboard
          .writeText(url)
          .then(() => {
            copyMsg.textContent = "âœ… Copied!";
            setTimeout(() => (copyMsg.textContent = ""), 2000);
          })
          .catch((err) => {
            copyMsg.textContent = "âŒ Copy failed";
            console.error(err);
          });
      });
    </script>
  </body>
</html>
